<!DOCTYPE html>
<html lang="en">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>BASED&CONFUSED</title>
		<link rel="stylesheet" href="jsmixtape/main.css">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Avenir, Helvetica, Arial, Sans-serif;
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}
			#trackTitle{
			/*width: 200px;*/
			display: inline-block;
			position: relative;
			white-space: nowrap;
			}


		</style>
	</head>
	<body>
		
		
		<div id="buttonsLeft">
			<div onclick="switchVid()" class="button playing" id="song1button" style="display: none;"><img src="img/sinjin.png"></div>
			<div onclick="switchVid()" class="button" id="song2button" style="display: block;"><img src="img/zora.png"></div>
		</div>
		<div id="audioplayer">
        <button id="pButton" class="play" style="width: 30px; height: 30px;
    	background-size: 100% 100%;left: 15px; bottom: 15px;  "></button>
  		<div id="timeline">
     		 <ul id="credits">
     		 <div class="left">
       			 <li>
            		<b>BASED & CONFUSED</b> | SINJIN HAWKE & ZORA JONES</br>
            		Visual by Ezra Miller <br>
            		<div id="titleContainer">
	            		<span id="trackTitle"></span> 
            		</div>
        		</li>
        	 </div>
        		</center>
      </ul>
      <div id="playhead"></div>
    </div>
        <div id="icons">
       <div id="volumeContainer">
	       	<a href="https://api.soundcloud.com/tracks/220575924/download?secret_token=s-lNd99&client_id=02gUJC0hH2ct1EGOcYXQIzRFU91c72Ea&oauth_token=1-138878-11750333-43e80c8bc71589"><i class="demo-icon icon-download download">&#xe801;</i></a>
          <i id="volume" class="volume demo-icon icon-volume-up">&#xe805;</i> 
        </div>
        <div id="halfContainer">
	       	<a href="https://api.soundcloud.com/tracks/220575924/download?secret_token=s-lNd99&client_id=02gUJC0hH2ct1EGOcYXQIzRFU91c72Ea&oauth_token=1-138878-11750333-43e80c8bc71589"><i class="demo-icon icon-download download">&#xe801;</i></a>
	        <i id="half" class="volume demo-icon icon-half">&#xe804;</i> 
        </div>
        <div id="muteContainer">
	       	<a href="https://api.soundcloud.com/tracks/220575924/download?secret_token=s-lNd99&client_id=02gUJC0hH2ct1EGOcYXQIzRFU91c72Ea&oauth_token=1-138878-11750333-43e80c8bc71589"><i class="demo-icon icon-download download">&#xe801;</i></a>
            <i id="mute" class="volume demo-icon icon-mute">&#xe803;</i> 
        </div> 
    	</div>
    	</div>
    	
 		<iframe style="display:none;" id="mix" width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/219210929&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true"></iframe>
		<script src="jsmixtape/DetectorMixtape.js"></script>
		<script src="js/RequestAnimationFrame.js"></script>
		<script src="js/Stats.js"></script>
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-86951-7']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
		  })();
		</script>
		<script src="js/three.min.js"></script>
		<script src="js/ThreeJsUtils.js"></script>

		<script src="js/FeedbackMaterial.js"></script>
		<script src="js/CustomShaders.js"></script>
		<script src="js/CCapture.min.js"></script>
		<script src="js/gif.js"></script>
		<script src="js/gif.worker.js"></script>
		<script src="js/Whammy.js"></script>
		<script id="vs" type="x-shader/x-vertex">

			uniform sampler2D map;

			uniform float width;
			uniform float height;
			uniform float nearClipping, farClipping;

			varying vec2 vUv;

			const float XtoZ = 1.11146; // tan( 1.0144686 / 2.0 ) * 2.0;
			const float YtoZ = 0.83359; // tan( 0.7898090 / 2.0 ) * 2.0;

			void main() {

				vUv = vec2( position.x / width, 1.0 - ( position.y / height ) );

				vec4 color = texture2D( map, vUv );
				float depth = ( color.r + color.g + color.b ) / 3.0;

				// Projection code by @kcmic

				float z = ( 1.0 - depth ) * (farClipping - nearClipping) + nearClipping;

				vec4 pos = vec4(
					( position.x / width - 0.5 ) * z * XtoZ,
					( position.y / height - 0.5 ) * z * YtoZ,
					- z + 1000.0,
					1.0);

				gl_PointSize = 1.0;
				gl_Position = projectionMatrix * modelViewMatrix * pos;

			}

		</script>
		<script id="testVs" type="x-shader/x-vertex">
			varying vec2 vUv;
			void main() {
			    vUv = uv;
			    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		</script>

		<script id="fs" type="x-shader/x-fragment">

			uniform sampler2D map;
			uniform float blue;

			varying vec2 vUv;

			void main() {

				vec4 color = texture2D( map, vUv );
				// if((( color.r + color.g + color.b ) / 3.0) < 0.1){
					// discard;
				// } else {
				if(blue>0.5){
					gl_FragColor = vec4( color.r, color.g, color.b, smoothstep( 8000.0, -8000.0, gl_FragCoord.z / gl_FragCoord.w ) );
				} else {
					gl_FragColor = vec4( 1.0,1.0,1.0, smoothstep( 8000.0, -8000.0, gl_FragCoord.z / gl_FragCoord.w ) );
				}
				// }

			}

		</script>

		<script>

			var container;

			var scene, camera, light, renderer;
			var geometry, cube, mesh, material;
			var mouse, center;
			var stats;
			var container;
			var scene, renderer, camera, controls;
			var fbScene, fbRenderer, fbCamera, fbTexture, fbShaders, fbMaterial;
			var mouseX = 0, mouseY = 0;
			var time = 0;
			var texture;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var start = Date.now(); 
			var gradient, tex;
			var meshes = [];
			var obj;
			var counter = 0;
			var rtt;
			var captureFrame = 0;
			var sizeMult = 1;
			var capturer = new CCapture( { format: 'webm', workersPath: 'js/' } );

			var video, texture;
			var blue = 0.0;

			init();
			// fbInit();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );


				scene = new THREE.Scene();
				center = new THREE.Vector3();
				center.z = - 1000;

				camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.set( 0, 0, 500 );
				scene.add( camera );

				video = document.createElement( 'video' );

				texture = new THREE.Texture( video );
				texture.minFilter = texture.magFilter = THREE.NearestFilter;
				video.loop = true;
				// video.src = 'textures/kinect.webm';
				video.src = 'textures/kinect.mp4';
				video.play();
				vidGeometry = new THREE.PlaneBufferGeometry(640, 480);
				vidMaterial = new THREE.MeshBasicMaterial({map: texture, transparent:true, opacity:0.0});
				vidMesh = new THREE.Mesh(vidGeometry, vidMaterial);
				vidMesh.position.z = 0;
				// mesh.visible = false;
				scene.add(vidMesh);
				video.addEventListener( 'loadedmetadata', function ( event ) {
					var width = 640, height = 480;
					var nearClipping = 850/*850*/, farClipping = 4000/*4000*/;

					geometry = new THREE.Geometry();

					for ( var i = 0, l = width * height; i < l; i ++ ) {
 
						var position = new THREE.Vector3();
						position.x = ( i % width );
						position.y = Math.floor( i / width );

						geometry.vertices.push( position );

					}
					// geometry = new THREE.PlaneBufferGeometry(1000, 1000,500,500);
					var testTex = THREE.ImageUtils.loadTexture("textures/testTex.jpg");
					material = new THREE.ShaderMaterial( {

						uniforms: {

							"map": { type: "t", value: 0, texture: texture },
							"test": { type: "t", value: testTex },
							"width": { type: "f", value: width },
							"height": { type: "f", value: height },
							"nearClipping": { type: "f", value: nearClipping },
							"farClipping": { type: "f", value: farClipping },
							"blue": { type: "f", value: 0.0 }

						},
						vertexShader: document.getElementById( 'vs' ).textContent,
						fragmentShader: document.getElementById( 'fs' ).textContent,
						// depthWrite: false

					} );
					// material = new THREE.PointCloudMaterial({map: texture});
					// material = new THREE.MeshBasicMaterial({map: texture});

					mesh = new THREE.PointCloud( geometry, material );
					// mesh = new THREE.Mesh(geometry, material);
					// mesh.position.x = -500;
					// mesh.position.y = -500;
					// mesh.position.z = -1000;
					mesh.rotation.z = Math.PI;
					scene.add( mesh );


				}, false );


				renderer = new THREE.WebGLRenderer({preserveDrawingBuffer:true});
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0x000000,1.0);
				container.appendChild( renderer.domElement );

				mouse = new THREE.Vector3( 0, 0, 1 );
				// projector = new THREE.Projector();
				// ray = new THREE.Ray( camera.position );

				// renderer.autoClearColor = false;


				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				document.addEventListener( 'touchstart', onDocumentTouchMove, false );
				document.addEventListener( 'touchmove', onDocumentTouchMove, false );

			}

			function onDocumentMouseMove( event ) {

				mouse.x = ( event.clientX - window.innerWidth / 2 ) * 8;
				mouse.y = ( event.clientY - window.innerHeight / 2 ) * 8;

			    unMappedMouseX = (event.clientX );
			    unMappedMouseY = (event.clientY );
			    mouseX = map(unMappedMouseX, window.innerWidth, -1.0,1.0);
			    mouseY = map(unMappedMouseY, window.innerHeight, -1.0,1.0);
			    
			    
			    // for(var i = 0; i < fbMaterial.fbos.length; i++){
			    //   fbMaterial.fbos[i].material.uniforms.mouse.value = new THREE.Vector2(mouseX, mouseY);
			    // }
    

			}

			function onDocumentTouchMove( event ) {

				mouse.x = ( event.touches[0].clientX - window.innerWidth / 2 ) * 8;
				mouse.y = ( event.touches[0].clientY - window.innerHeight / 2 ) * 8;

			    unMappedMouseX = (event.touches[0].clientX );
			    unMappedMouseY = (event.touches[0].clientY );
			    mouseX = map(unMappedMouseX, window.innerWidth, -1.0,1.0);
			    mouseY = map(unMappedMouseY, window.innerHeight, -1.0,1.0);
			    
			    
			    // for(var i = 0; i < fbMaterial.fbos.length; i++){
			    //   fbMaterial.fbos[i].material.uniforms.mouse.value = new THREE.Vector2(mouseX, mouseY);
			    // }
    

			}

			function animate() {

				requestAnimationFrame( animate );

				render();
			    // fbDraw();

			}

			function render() {
				texture.needsUpdate = true;
				mesh.material.uniforms.blue.value = blue;

				camera.position.x += ( mouse.x - camera.position.x ) * 0.05;
				camera.position.y += ( - mouse.y - camera.position.y ) * 0.05;
				camera.lookAt( center );

				renderer.render( scene, camera );


			}

			function fbInit(){

			    fbScene = new THREE.Scene();
			    fbCamera = new THREE.OrthographicCamera( window.innerWidth / - 2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / - 2, -10000, 10000 );
			    fbCamera.position.set(0,0,0);

			    fbCamera2 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 100000);
			    fbCamera2.position.z = 750;

			    // controls = new THREE.OrbitControls(fbCamera2);


			    fbRenderer = new THREE.WebGLRenderer({ preserveDrawingBuffer: true/*, alpha: true*/});
			    fbRenderer.setClearColor(0xffffff, 1.0);
			    fbRenderer.setSize(window.innerWidth/sizeMult, window.innerHeight/sizeMult);
			    
			    container.appendChild(fbRenderer.domElement);

			    fbScene = new THREE.Scene();
			    

			    // canv = document.createElement("CANVAS");
			    // canv.width = window.innerWidth;
			    // canv.height = window.innerHeight;
			    // ctx = canv.getContext("2d");
			    // ctx.fillStyle = "white";
			    // ctx.fillRect(0,0,window.innerWidth, window.innerHeight);
			    // ctx.drawImage(renderer.domElement,0,0, window.innerWidth, window.innerHeight);
			    fbTexture = new THREE.Texture(renderer.domElement);
			    fbTexture.minFilter = fbTexture.magFilter = THREE.NearestFilter;
			    // fbTexture = THREE.ImageUtils.loadTexture("tex/rach.jpg")
			    // fbTexture = THREE.ImageUtils.loadTexture("tex/rgblcd.jpg");
			    // var clone = rtt.clone();
			    fbMesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(window.innerWidth, window.innerHeight), new THREE.MeshBasicMaterial({map:fbTexture}));
			    fbScene.add(fbMesh);

			    var customShaders = new CustomShaders();
			    var customShaders2 = new CustomShaders();

			    fbShaders = [ 
			        customShaders.reposShader, 
			        customShaders.blurShader, 
			        customShaders.diffShader2, 
			        customShaders.reposShader, 
			        customShaders2.sharpenShader,
			        customShaders.passShader
			    ];

			    // fbShaders = [ 
			    //     customShaders.reposShader, 
			    //     customShaders.flowShader, 
			    //     customShaders.diffShader, 
			    //     customShaders2.reposShader, 
			    //     customShaders2.passShader,
			    //     customShaders.passShader
			    // ];

			    // fbMaterial = new FeedbackMaterial(fbRenderer, fbScene, fbCamera, fbTexture, fbShaders);
			        
			    // fbMaterial.init();


			    document.addEventListener( 'keydown', function(){screenshot(fbRenderer)}, false );
			    document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			    // document.addEventListener( 'mousedown', onDocumentMouseDown, false );
			    // window.addEventListener( 'resize', onWindowResize, false );

			}
			function fbDraw(){
    
			    // ctx.fillStyle = "white";
			    // ctx.fillRect(0,0,window.innerWidth, window.innerHeight);
			    // ctx.drawImage(renderer.domElement, 0, 0, window.innerWidth, window.innerHeight);
			    time+=0.01;

			    // for(var i = 0; i < fbMaterial.fbos.length; i++){
			    //   fbMaterial.fbos[i].material.uniforms.time.value = time;
			    //   fbMaterial.fbos[i].material.uniforms.mouse.value = new THREE.Vector2(Math.sin(time), Math.cos(time));
			    // }
			    fbTexture.needsUpdate = true;
			        
			    // fbMaterial.update();
			    // fbMaterial.expand(1.01);

			    fbRenderer.render(fbScene, fbCamera);

			    // fbMaterial.getNewFrame();
			    // fbMaterial.swapBuffers();

			    // capturer.capture( fbRenderer.domElement );

			    
			}
			function switchVid(){
				if(counter%2==0){
					video.src = 'textures/new1.mp4';
					video.play();
					blue = 1.0;
					document.getElementById("song1button").style.display = "block";
					document.getElementById("song2button").style.display = "none";
				} else {
					video.src = 'textures/kinect.mp4';
					video.play();
					blue = 0.0;
					document.getElementById("song1button").style.display = "none";
					document.getElementById("song2button").style.display = "block";

				}
				counter++;
			}
		</script>
		<script src="jsmixtape/jquery.min.js"></script>
		<script src="jsmixtape/soundcloudAPI.js"></script>
		<script src="//connect.soundcloud.com/sdk-2.0.0.js"></script>
		<script src="jsmixtape/tracklist.js"></script>

	<script> //TEXT SCROLL SCRIPT//

	$(function() {

	    var txt = $("#trackTitle");

	    txt.bind('scroll', function () {
	        var el = $(this);
	        // Scroll state machine
	        var scrollState = txt.data("scrollState") || 0;
	        txt.data("scrollState", (scrollState + 1) % 4);
	        switch (scrollState) {
	            case 0: // initial wait
	                txt.css({ left: 0 });
	                txt.show();
	                window.setTimeout(function () {
	                    txt.trigger("scroll");
	                }, 5000);
	                break;
	            case 1: // start scroll
	                var delta = txt.parent().width() - txt.width();
	                if (delta < 0) {
	                	console.log("scrolling");
	                    txt.animate({ left: delta }, 2000, "linear", function () {
	                        txt.trigger("scroll");
	                    });
	                }
	                break;
	            case 2: // delay before scroll back
	                window.setTimeout(function () {
	                    txt.trigger("scroll");
	                }, 2000);
	                break;
	            case 3: // fade out
	                txt.fadeOut("slow", function () {
	                    txt.trigger("scroll");
	                });
	                break;
	        }
	    }).trigger("scroll");
	});
	</script>
  	<script> //PLAYER SCRIPT//
  	
  var getDuration = function(millis){
    var dur = {};
    var units = [
        {label:"millis",    mod:1000},
        {label:"seconds",   mod:60},
        {label:"minutes",   mod:60},
        {label:"hours",     mod:24},
        {label:"days",      mod:31}
    ];
    // calculate the individual unit values...
    units.forEach(function(u){
        millis = (millis - (dur[u.label] = (millis % u.mod))) / u.mod;
    });
    // convert object to a string representation...
    dur.toString = function(){
        return units.reverse().map(function(u){
            return dur[u.label] + " " + (dur[u.label]==1?u.label.slice(0,-1):u.label);
        }).join(', ');
    };
    return dur;
};
		var duration; // Duration of audio clip
		var pButton = document.getElementById('pButton'); // play button

		var audioplayer = document.getElementById('audioplayer'); // playhead
		var playhead = document.getElementById('playhead'); // playhead

		var timeline = document.getElementById('timeline'); // timeline

		var icons = document.getElementById('icons'); // timeline
		var volume = document.getElementById('volume'); // timeline
		var volumeContainer = document.getElementById('volumeContainer'); // timeline
		var half = document.getElementById('half'); // timeline
		var mute = document.getElementById('mute'); // timeline
		var volumeBar = document.getElementById('volumeBar'); // timeline
		var innerVolume = document.getElementById('innerVolume'); // timeline
		var download = document.getElementsByClassName('download'); // timeline
		// timeline width adjusted for playhead
		console.log(volumeContainer.offsetWidth);
		var timelineWidth = window.innerWidth - (volumeContainer.offsetWidth + 60);
		var timelineHeight = 60;
		var counter = 0;
		var volumeBarHeight = 120;
		var volumeAmt = 1.0;
		var trackTitle = document.getElementById("trackTitle");
		var mix = document.getElementById("mix");
		var song;
		var updater;
		SC.initialize({
		  client_id: "cd406b735309b14551e8af7a54c8e6f3"
		});
		//220575924
		SC.stream("/tracks/219210929", {
		  useHTML5Audio: true,
		  preferFlash: false
		}, function(sound) {
			console.log(sound);
		  song = sound;
		  sound._player.on("positionChange", function(state){
		  		update();
		  })
		  pButton.style.display = "block";
		});

		var currentDuration;
		var currentTime;
		var relativePosition;
		var volumeCounter = 0;
		// icons.addEventListener("click", function(event){
		// 	// volumeBar.style.display = "block";
		// 	console.log(event);
		// 	if(event.target.className == "demo-icon icon-download") {
		// 	}
		// 	if(event.target.className == "volume demo-icon icon-half" || "volume demo-icon icon-mute" || "volume demo-icon icon-volume-up"){
		// 		if(volumeCounter%3==0){
		// 			volume.style.display = "none";
		// 			half.style.display = "block";
		// 			mute.style.display = "none";
		// 			song.setVolume(0.5);	
		// 		} else if (volumeCounter%3==1){
		// 			volume.style.display = "none";
		// 			half.style.display = "none";
		// 			mute.style.display = "block";
		// 			song.setVolume(0.0);
		// 		} else if (volumeCounter%3==2){
		// 			volume.style.display = "block";
		// 			half.style.display = "none";
		// 			mute.style.display = "none";
		// 			song.setVolume(1.0);
		// 		}
		// 		volumeCounter++;
		// 	}

		// })	
		volume.addEventListener("click", function(event){
			volume.parentElement.style.display = "none";
			half.parentElement.style.display = "block";
			mute.parentElement.style.display = "none";
			song.setVolume(0.5);
		})
		half.addEventListener("click", function(event){
			volume.parentElement.style.display = "none";
			half.parentElement.style.display = "none";
			mute.parentElement.style.display = "block";
			song.setVolume(0.0);
		})		
		mute.addEventListener("click", function(event){
			volume.parentElement.style.display = "block";
			half.parentElement.style.display = "none";
			mute.parentElement.style.display = "none";
			song.setVolume(1.0);
		})		
		download[0].addEventListener("click", function(event){
			console.log('download');
		})	
		download[1].addEventListener("click", function(event){
			console.log('download');
		})	
		download[2].addEventListener("click", function(event){
			console.log('download');
		})						
		var onvolume = false;
		// volumeBar.addEventListener("click", function(event){
		// 	movevolumehead(event);
		// 	music.volume = volumeAmt * volumeClickPercent(event);
		// })	
		// volumeBar.addEventListener("mousedown", function(event){
		// 	onvolume = true;
		// 	volumeBar.addEventListener('mousemove', movevolumehead, true);
		// })	
		pButton.addEventListener("click", play, true);

		// pButton.addEventListener("touchstart", play);

		// timeline.addEventListener("click", function (event) {
		// 	// console.log(event);
		// 	onplayhead = true;
		// 	moveplayhead(event);
		// }, true);
		timeline.addEventListener("touchstart", function(e){
			e.preventDefault();
			moveplayhead(e);
			onplayhead = true;
			window.addEventListener('touchmove', moveplayhead, true);

		})
		window.addEventListener('touchcancel', function(){
			window.removeEventListener('touchmove', moveplayhead, true);
			onplayhead = false;
		}, false);
		window.addEventListener('touchend', function(){
			window.removeEventListener('touchmove', moveplayhead, true);
			onplayhead = false;
		}, false);
		function clickPercent(e) {
			return (e.pageX - timeline.offsetLeft) / timelineWidth;
		}

		function volumeClickPercent(e) {
			return (((window.innerHeight - e.pageY) - timelineHeight)/volumeBarHeight);
		}

		timeline.addEventListener('mousedown', mouseDown, false);
		window.addEventListener('mouseup', mouseUp, false);

		var onplayhead = false;
		function mouseDown(event) {
			onplayhead = true;
			moveplayhead(event);
			window.addEventListener('mousemove', moveplayhead, true);
			window.addEventListener('touchmove', moveplayhead, true);
		}
		function mouseUp(e) {
			if (onplayhead == true) {
				moveplayhead(e);
				window.removeEventListener('mousemove', moveplayhead, true);
				window.removeEventListener('touchmove', moveplayhead, true);

			}
			onplayhead = false;
		}
		function moveplayhead(e) {
			var newMargLeft = e.pageX - timeline.offsetLeft;
			if (newMargLeft >= 0 && newMargLeft <= timelineWidth) {
				playhead.style.marginLeft = newMargLeft + "px";
			}
			if (newMargLeft < 0) {
				playhead.style.marginLeft = "0px";
			}
			if (newMargLeft > timelineWidth) {
				playhead.style.marginLeft = timelineWidth + "px";
			}
			var newTime = (1 - ((timelineWidth - newMargLeft)/timelineWidth))*currentDuration;
			currentTime = newTime;
			song.seek(currentTime);
		}

		function movevolumehead(e) {
			var newMargTop = ((window.innerHeight - e.pageY) - timelineHeight);
			// var newMargLeft = e.pageX - timeline.offsetLeft;
			if (newMargTop >= 0 && newMargTop <= window.innerHeight) {
				innerVolume.style.marginTop = (120 - newMargTop) + "px";
			}
			if (newMargTop < 0) {
				innerVolume.style.marginTop = "120px";
			}
			if (newMargTop > timelineWidth) {
				innerVolume.style.marginTop = "0px";
			}
		}

		// timeUpdate 
		// Synchronizes playhead position with current point in audio 
		function timeUpdate() {
			// updateTitle();
			// var playPercent = timelineWidth * (music.currentTime / duration);
			// playhead.style.marginLeft = playPercent + "px";
			// if (music.currentTime == duration) {
			// 	pButton.className = "";
			// 	pButton.className = "play";
			// }
		}

		//Play and Pause
		var counter = 0;
		function play() {
			// start music
			// song.isPaused(function(e){
				if(song.getState() !== "playing"){
					song.play();
					// update();
					song.seek(currentTime);
					pButton.className = "";
					pButton.className = "pause";
				} else {
					song.pause();
					// cancelAnimationFrame(updater);
					// updater = null;
					pButton.className = "";
					pButton.className = "play";	
				}
				// song._player._onPositionChange = function(e){

				// }
			// })
			// song.bind(SC.Widget.Events.PLAY, function(e) {
			// 	song.getCurrentSound(function(currentSound){
			// 		currentDuration = currentSound.duration;
			// 		var dur = getDuration(currentSound.duration)
		 //        	var str = dur.minutes + ":" + dur.seconds;
		 //        	// duration.innerHTML = str;
			// 	})
		 //    });
   //  		song.bind(SC.Widget.Events.PLAY_PROGRESS, function(e) {
		 //    	updateTitle();
			// 	currentTime = e.currentPosition;
			// 	var time = getDuration(currentTime);

			// 	if(time.seconds < 10){
			// 		time.seconds = "0" + time.seconds;
			// 	}
			// 	var str = time.minutes + ":" + time.seconds;
			// 	// currentTime.innerHTML = str;

			// 	relativePosition = e.relativePosition;
			// 	playhead.style.marginLeft = (timelineWidth*relativePosition) + "px";
			// });
		}
		function update(){
			// updater = requestAnimationFrame(update);
			currentDuration = song.getDuration();
			var dur = getDuration(currentDuration);
			var str = dur.minutes + ":" + dur.seconds;
			currentTime = song.getCurrentPosition();
			// currentTime = song._player._prevCurrentPosition;
			var time = getDuration(currentTime);

			if(time.seconds < 10){
				time.seconds = "0" + time.seconds;
			}
			var str = time.minutes + ":" + time.seconds;
			// currentTime.innerHTML = str;
			relativePosition = currentTime/currentDuration;
			playhead.style.marginLeft = (timelineWidth*relativePosition) + "px";
			updateTitle();
		}
		function updateTitle(){
			for(var i = 0; i < tracklist.length; i++){
				if(currentTime>(tracklist[i].time)*1000){
					trackTitle.innerHTML = tracklist[i].title

				}
			}
		}

		window.addEventListener("resize", function(){
			timelineWidth = window.innerWidth - 120;
			timeUpdate();
		})


	</script>
	
	
	
	
	</body>
</html>