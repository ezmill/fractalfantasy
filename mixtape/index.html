<html lang="en" style="visibility: visible;">
<head>	
		<title>BASED & CONFUSED</title>
		<link rel="stylesheet" href="main.css">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}
			.left {
  		  	float: left;
    		margin-left: 15px;
}
		#trackTitle{
			/*width: 200px;*/
			display: inline-block;
			position: relative;
			white-space: nowrap;
		}
		#titleContainer{
			display: inline-block;
			width: 200px;
			overflow: hidden;
		}
		.test{
			
		}
		</style>
		</head>
		<body cz-shortcut-listen="true">		
		<script src="jsmixtape/jquery.min.js"></script>
		<script src="//cdn.jsdelivr.net/jquery.marquee/1.3.1/jquery.marquee.min.js"></script>

		<!-- // <script src="jsmixtape/three.min.js"></script> -->
		<!-- // <script src="jsmixtape/ThreeJsUtils.js"></script> -->
		<!-- // <script src="jsmixtape/FeedbackMaterial.js"></script> -->
		<!-- // <script src="jsmixtape/CustomShaders.js"></script> -->
		<!-- // <script src="jsmixtape/CCapture.min.js"></script> -->
		<!-- // <script src="jsmixtape/gif.js"></script> -->
	    <script src="jsmixtape/tracklist.js"></script>
		<!-- // <script src="jsmixtape/gif.worker.js"></script> -->
		<!-- // <script src="jsmixtape/Whammy.js"></script> -->
		<!-- // <script src="jsmixtape/main.js"></script> -->

		<script id="vs" type="x-shader/x-vertex">
		

			uniform sampler2D map;

			uniform float width;
			uniform float height;
			uniform float nearClipping, farClipping;

			varying vec2 vUv;

			const float XtoZ = 1.11146; // tan( 1.0144686 / 2.0 ) * 2.0;
			const float YtoZ = 0.83359; // tan( 0.7898090 / 2.0 ) * 2.0;

			void main() {

				vUv = vec2( position.x / width, 1.0 - ( position.y / height ) );

				vec4 color = texture2D( map, vUv );
				float depth = ( color.r + color.g + color.b ) / 3.0;

				// Projection code by @kcmic

				float z = ( 1.0 - depth ) * (farClipping - nearClipping) + nearClipping;

				vec4 pos = vec4(
					( position.x / width - 0.5 ) * z * XtoZ,
					( position.y / height - 0.5 ) * z * YtoZ,
					- z + 1000.0,
					1.0);

				gl_PointSize = 2.0;
				gl_Position = projectionMatrix * modelViewMatrix * pos;

			}

		</script>
		<script id="testVs" type="x-shader/x-vertex">
			varying vec2 vUv;
			void main() {
			    vUv = uv;
			    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}
		</script>

		<script id="fs" type="x-shader/x-fragment">

			uniform sampler2D map;

			varying vec2 vUv;

			void main() {

				vec4 color = texture2D( map, vUv );
				// if((( color.r + color.g + color.b ) / 3.0) < 0.1){
					// discard;
				// } else {
					gl_FragColor = vec4( color.r, color.g, color.b, smoothstep( 8000.0, -8000.0, gl_FragCoord.z / gl_FragCoord.w ) );
				// }

			}

		</script>

		<script>

		</script><div><canvas width="3360" height="1774" style="width: 1680px; height: 887px;"></canvas></div><div><canvas width="1440" height="743"></canvas></div>
		
	<audio id="music" preload="true">
	<source src="https://dl.dropboxusercontent.com/u/4513096/based%26confused%20mix%20alan%20mix%20for%20ezra.mp3"> 
 	 </audio>
  <div id="audioplayer">
    <button id="pButton" class="play"></button>
  		<div id="timeline">
	  <!--p id="title">
        <img id="titleImg" style="opacity: 0.7" src="img/unctionname2.png" alt="">
      </p--> 
     		 <ul id="credits">
     		 <div class="left">
       			 <li>
            		<b>BASED & CONFUSED</b> | SINJIN HAWKE & ZORA JONES</br>
            		Visual by Ezra Miller <br>
            		<div id="titleContainer">
	            		<span id="trackTitle"></span> 
            		</div>
        		</li>
        	 </div>
        		</center>
      </ul>
      <div id="playhead"></div>
    </div>
        <div id="icons">
               <div id="volume">
          <i class="demo-icon icon-volume-up">&#xe800;</i> 
        </div>
        <div id="half">
          <i class="demo-icon icon-half">&#xe801;</i> 
        </div>
        <div id="mute">
            <i class="demo-icon icon-mute">&#xe802;</i> 
        </div> 
    </div>
     	        <div id="volumeBar">
	        	<div id="innerVolume">
	        		
	        	</div>
	        </div>


  </div>
  <iframe style="display:none;" id="mix" width="100%" height="450" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/219210929&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true"></iframe>
  <script src="jsmixtape/soundcloudAPI.js"></script>
  <script>
  var getDuration = function(millis){
    var dur = {};
    var units = [
        {label:"millis",    mod:1000},
        {label:"seconds",   mod:60},
        {label:"minutes",   mod:60},
        {label:"hours",     mod:24},
        {label:"days",      mod:31}
    ];
    // calculate the individual unit values...
    units.forEach(function(u){
        millis = (millis - (dur[u.label] = (millis % u.mod))) / u.mod;
    });
    // convert object to a string representation...
    dur.toString = function(){
        return units.reverse().map(function(u){
            return dur[u.label] + " " + (dur[u.label]==1?u.label.slice(0,-1):u.label);
        }).join(', ');
    };
    return dur;
};
		var duration; // Duration of audio clip
		var pButton = document.getElementById('pButton'); // play button

		var audioplayer = document.getElementById('audioplayer'); // playhead
		var playhead = document.getElementById('playhead'); // playhead

		var timeline = document.getElementById('timeline'); // timeline

		var volume = document.getElementById('volume'); // timeline
		var volumeBar = document.getElementById('volumeBar'); // timeline
		var innerVolume = document.getElementById('innerVolume'); // timeline
		// timeline width adjusted for playhead
		var timelineWidth = window.innerWidth - 120;
		var timelineHeight = 60;
		var counter = 0;
		var volumeBarHeight = 120;
		var volumeAmt = 1.0;
		var trackTitle = document.getElementById("trackTitle");
		var mix = document.getElementById("mix");
		var song = SC.Widget(mix);
		var currentDuration;
		var currentTime;
		var relativePosition;

		volume.addEventListener("click", function(event){
			// volumeBar.style.display = "block";
			if(counter%2==0){
				volumeBar.className = "animateUp";
				innerVolume.className = "animateUp";				
			} else {
				volumeBar.className = "animateDown";
				innerVolume.className = "animateDown";	
			}
			counter++;
		})	
		var onvolume = false;
		// volumeBar.addEventListener("click", function(event){
		// 	movevolumehead(event);
		// 	music.volume = volumeAmt * volumeClickPercent(event);
		// })	
		// volumeBar.addEventListener("mousedown", function(event){
		// 	onvolume = true;
		// 	volumeBar.addEventListener('mousemove', movevolumehead, true);
		// })	
		// pButton.addEventListener("click", play);
		pButton.addEventListener("touchstart", play);

		timeline.addEventListener("click", function (event) {
			moveplayhead(event);
		}, false);
		timeline.addEventListener("touchstart", function(e){
			e.preventDefault();
			moveplayhead(e);
			onplayhead = true;
			window.addEventListener('touchmove', moveplayhead, true);

		})
		window.addEventListener('touchcancel', function(){
			window.removeEventListener('touchmove', moveplayhead, true);
			onplayhead = false;
		}, false);
		window.addEventListener('touchend', function(){
			window.removeEventListener('touchmove', moveplayhead, true);
			onplayhead = false;
		}, false);
		function clickPercent(e) {
			return (e.pageX - timeline.offsetLeft) / timelineWidth;
		}

		function volumeClickPercent(e) {
			return (((window.innerHeight - e.pageY) - timelineHeight)/volumeBarHeight);
		}

		timeline.addEventListener('mousedown', mouseDown, false);
		window.addEventListener('mouseup', mouseUp, false);

		var onplayhead = false;
		function mouseDown() {
			onplayhead = true;
			window.addEventListener('mousemove', moveplayhead, true);
			window.addEventListener('touchmove', moveplayhead, true);
		}
		function mouseUp(e) {
			if (onplayhead == true) {
				moveplayhead(e);
				window.removeEventListener('mousemove', moveplayhead, true);
				window.removeEventListener('touchmove', moveplayhead, true);

			}
			onplayhead = false;
			if(onvolume){
				movevolumehead(e);
				volumeBar.removeEventListener('mousemove', movevolumehead, true);
				// music.volume = volumeAmt * volumeClickPercent(e);
			}
			onvolume = false;
		}
		function moveplayhead(e) {
			var newMargLeft = e.pageX - timeline.offsetLeft;
			if (newMargLeft >= 0 && newMargLeft <= timelineWidth) {
				playhead.style.marginLeft = newMargLeft + "px";
			}
			if (newMargLeft < 0) {
				playhead.style.marginLeft = "0px";
			}
			if (newMargLeft > timelineWidth) {
				playhead.style.marginLeft = timelineWidth + "px";
			}
			var newTime = (1 - ((timelineWidth - newMargLeft)/timelineWidth))*currentDuration;
			song.seekTo(newTime);
		}

		function movevolumehead(e) {
			var newMargTop = ((window.innerHeight - e.pageY) - timelineHeight);
			// var newMargLeft = e.pageX - timeline.offsetLeft;
			if (newMargTop >= 0 && newMargTop <= window.innerHeight) {
				innerVolume.style.marginTop = (120 - newMargTop) + "px";
			}
			if (newMargTop < 0) {
				innerVolume.style.marginTop = "120px";
			}
			if (newMargTop > timelineWidth) {
				innerVolume.style.marginTop = "0px";
			}
		}

		// timeUpdate 
		// Synchronizes playhead position with current point in audio 
		function timeUpdate() {
			// updateTitle();
			// var playPercent = timelineWidth * (music.currentTime / duration);
			// playhead.style.marginLeft = playPercent + "px";
			// if (music.currentTime == duration) {
			// 	pButton.className = "";
			// 	pButton.className = "play";
			// }
		}

		//Play and Pause
		var counter = 0;
		function play() {
			// start music
			console.log(song);
			song.isPaused(function(e){
				if(e){
					song.play();
					pButton.className = "";
					pButton.className = "pause";
				} else {
					song.pause();
					pButton.className = "";
					pButton.className = "play";	
				}
			})

			song.bind(SC.Widget.Events.PLAY, function(e) {
				song.getCurrentSound(function(currentSound){
					currentDuration = currentSound.duration;
					var dur = getDuration(currentSound.duration)
		        	var str = dur.minutes + ":" + dur.seconds;
		        	// duration.innerHTML = str;
				})
		    });
    		song.bind(SC.Widget.Events.PLAY_PROGRESS, function(e) {
		    	updateTitle();
				currentTime = e.currentPosition;
				var time = getDuration(currentTime);

				if(time.seconds < 10){
					time.seconds = "0" + time.seconds;
				}
				var str = time.minutes + ":" + time.seconds;
				// currentTime.innerHTML = str;

				relativePosition = e.relativePosition;
				playhead.style.marginLeft = (timelineWidth*relativePosition) + "px";
			});
		}
		function updateTitle(){
			for(var i = 0; i < tracklist.length; i++){
				if(currentTime>(tracklist[i].time)*1000){
					trackTitle.innerHTML = tracklist[i].title
				}
			}
		}

		window.addEventListener("resize", function(){
			timelineWidth = window.innerWidth - 120;
			timeUpdate();
		})


	</script>
	<script>

	$(function() {


		  // $box = $('#box');
		  // $box.children().each(function(){
		  //   if ($box.width() < $(this).width()) {
		  //     $(this).wrap('<marquee>' );

		  //   }
		  // });

	    var txt = $("#trackTitle");
	    txt.bind('scroll', function () {
	        var el = $(this);
	        // Scroll state machine
	        var scrollState = el.data("scrollState") || 0;
	        el.data("scrollState", (scrollState + 1) % 4);
	        switch (scrollState) {
	            case 0: // initial wait
	                el.css({ left: 0 });
	                el.show();
	                window.setTimeout(function () {
	                    el.trigger("scroll");
	                }, 5000);
	                break;
	            case 1: // start scroll
	                var delta = el.parent().width() - el.width();
	                if (delta < 0) {
	                    el.animate({ left: delta }, 2000, "linear", function () {
	                        el.trigger("scroll");
	                    });
	                }
	                break;
	            case 2: // delay before scroll back
	                window.setTimeout(function () {
	                    el.trigger("scroll");
	                }, 2000);
	                break;
	            case 3: // fade out
	                el.fadeOut("slow", function () {
	                    el.trigger("scroll");
	                });
	                break;
	        }
	    }).trigger("scroll");
	});
	</script>

</body></html>